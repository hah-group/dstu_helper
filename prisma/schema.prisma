// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  buttonId                Int                @buttonId
  firstName         String
  lastName          String
  groupId           Int?
  Group             StudyGroup?        @relation(fields: [groupId], references: [buttonId])
  ConversationUsers ConversationUser[]
}

model Conversation {
  buttonId                Int                @buttonId
  title             String?
  settings          Json
  ConversationUsers ConversationUser[]
  status            ConversationStatus @default(NOT_CONFIGURED)
}

model ConversationUser {
  buttonId             Int          @buttonId @default(autoincrement())
  userId         Int
  conversationId Int
  role           Role
  User           User         @relation(fields: [userId], references: [buttonId])
  Conversation   Conversation @relation(fields: [conversationId], references: [buttonId])

  @@unique([userId, conversationId])
}

model StudyGroup {
  buttonId           Int          @buttonId
  name         String       @unique
  updateStatus UpdateStatus @default(DONE)
  Lessons      Lesson[]
  Users        User[]
}

model Lesson {
  buttonId         String     @buttonId
  groupId    Int
  start      DateTime   @db.Timestamp
  end        DateTime   @db.Timestamp
  isTopWeek  Boolean
  type       LessonType
  order      Int
  name       String
  teacherId  Int?
  subgroup   Int?
  subsection String?
  corpus     String?
  classRoom  String?
  distance   Boolean
  updateAt   DateTime   @default(now())
  Group      StudyGroup @relation(fields: [groupId], references: [buttonId])
  Teacher    Teacher?   @relation(fields: [teacherId], references: [buttonId])
}

model Teacher {
  buttonId         Int      @buttonId
  firstName  String?
  lastName   String
  middleName String?
  Lessons    Lesson[]
}

enum Role {
  STUDENT
  ADMIN
}

enum UpdateStatus {
  DONE
  IN_PROGRESS
  FAILURE
}

enum LessonType {
  LECTURE
  PRACTICAL
  LABORATORY
  EXAMINATION
  EXAM_WITHOUT_MARK
}

enum ConversationStatus {
  NOT_CONFIGURED
  LIMITED
  FULL
}
